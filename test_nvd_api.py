import requests
import logging
import time

# Configure logging
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

def get_vulnerabilities(port, username, password):
    vulnerabilities = []
    url = 'https://www.opencve.io/api/cve'
    params = {
        'search': port,
    }
    retry_count = 5
    backoff_factor = 1
    while retry_count > 0:
        try:
            logger.debug(f"Fetching vulnerabilities for port: {port}")
            response = requests.get(url, params=params, auth=(username, password))
            if response.status_code == 200 and 'application/json' in response.headers.get('Content-Type', ''):
                vulnerabilities.extend(response.json())
                break
            else:
                logger.error(f"Failed to fetch vulnerabilities: {response.status_code} {response.text}")
        except Exception as e:
            logger.error(f"Error getting vulnerabilities: {e}")
        retry_count -= 1
        logger.info(f"Retrying... ({retry_count} retries left)")
        time.sleep(backoff_factor * (5 - retry_count))
    return vulnerabilities

def main():
    username = 'darth_daddio'  # Replace with your OpenCVE username
    password = '3p$ALN9$bhVzn6f'  # Replace with your OpenCVE password
    port = 80  # You can change this to any port you want to test
    vulnerabilities = get_vulnerabilities(port, username, password)
    if vulnerabilities:
        print(f"Vulnerabilities for port {port}:")
        for vuln in vulnerabilities:
            print(vuln)
    else:
        print(f"No vulnerabilities found for port {port}")

if __name__ == '__main__':
    main()
